//*****************************************************************************
//*****************************************************************************
//
// SKILL TAMING 
//
//	Galthar
//	UsMarine (vinicius.arroyo at gmail.com)
//
//*****************************************************************************
//*****************************************************************************

//TODO:

//TAGS usadas:

//*****************************************************************************
//*****************************************************************************
// EVENTSs
//*****************************************************************************
//*****************************************************************************
[EVENTS e_tamingcheck]
ON=@GETHIT
findid.i_taming.remove
events=-e_tamingcheck
sysmessagered Voce se desconcentrou.

//*****************************************************************************
//*****************************************************************************
// FUNCTIONs
//*****************************************************************************
//*****************************************************************************

//*****************************************************************************
// sk_taming
//*****************************************************************************
[FUNCTION sk_taming]

if (<src.targ.distance>>4)
	src.sysmessageyellow Aproxime-se mais.
	return 1
endif

// Checar se ja foi tamed
if (<src.targ.memoryfindtype.memory_ipet>)
	src.sysmessageyellow Este animal ja possui dono...
elif (<src.findid.i_taming>)
	src.sysmessageyellow Voce so pode domar um animal por vez...
elif (<src.targ.npc>!=brain_animal)
	src.sysmessageyellow Voce so pode domar animais...
else
	serv.newitem i_taming
	new.cont=<src>
	new.link=<src.targ>
	src.events=+e_tamingcheck
endif
return 1

//*****************************************************************************
//*****************************************************************************
// ITEMDEFs
//*****************************************************************************
//*****************************************************************************

//*****************************************************************************
// i_taming
//*****************************************************************************
[ITEMDEF i_taming] 
ID=i_deed
NAME=Taming Memory 
TYPE=t_eq_script 
WEIGHT=0 
LAYER=layer_special 

ON=@CREATE 
ATTR=attr_decay
MORE=15-(<cont.taming>/100) //5 a 15 segundos
TIMER=1

ON=@TIMER

// Checar distancia
if (<link.distance <cont>>>4) || !(<link.canseelos <cont>>)
	cont.sysmessageyellow O animal se distanciou demais.
	cont.events=-e_tamingcheck
	remove
	return 1
endif

// Se o animal estiver sendo atacado
if (<link.flags>&statf_War)
	cont.sysmessageyellow O animal nao pode ser domado enquanto estiver enfurecido.
	cont.events=-e_tamingcheck
	remove
	return 1
endif

// Se estiver em war mode
if (<cont.flags>&statf_War)
	cont.sysmessageyellow O animal se assusta com seus movimentos.
	cont.events=-e_tamingcheck
	remove
	return 1
endif

//loop de animacao
if (<more>)
	more=<more>-1
	timer=1
	dorand 8
		cont.say Nao vou machucar voce. 
		cont.say Eu sempre quis um <link.name> como voce. 
		cont.say Aqui <link.name>. 
		cont.say Bom <link.name>. 
	enddo
	return 1 
endif
	
LOCAL.t1=<R0,<link.taming>>
LOCAL.t2=<R0,<cont.taming>>
LOCAL.f=<R0,100>
//faz teste de skill taming e de fome do animal
if (<LOCAL.t1> < <LOCAL.t2>) && (<LOCAL.f> > <link.food>)
	cont.sysmessage Parece que ele aceitou voce como novo dono.
//    if (<link.memoryfindtype.memory_ispawned>)
	link.memoryfindtype.memory_ispawned.remove
	serv.newitem=i_memory
	new.color=memory_ipet
	new.more1=04
	new.more2=<serv.time>
	new.morep=<link.p>
	new.link=<cont>
	new.cont=<link>
	link.flags=<link.flags>|statf_pet
	link.update
//faz outro teste de fome para ver se somente falha ou se ataca o domador
elif (<LOCAL.f> > <link.food>)
	cont.sysmessageyellow O animal esta enfurecido.
	link.flags=<link.flags>|statf_war
	dorand 3
		link.attack <cont>
	enddo
else
	cont.sysmessagegreen Voce falhou ao tentar domar o animal.
endif

cont.skill_gain skill_taming
cont.events=-e_tamingcheck
remove
return 1

[EOF]